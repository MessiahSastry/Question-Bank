<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AI Question Generator</title>
  <link rel="stylesheet" href="style.css" />
  <!-- MathJax for pretty math -->
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [["$", "$"], ["\\(", "\\)"]],
      },
      svg: { fontCache: "global" },
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</head>
<body>
  <button onclick="window.location.href='dashboard.html'" style="margin:10px;">‚Üê Back to Dashboard</button>

  <div class="container" style="max-width: 420px; margin: auto; padding: 28px; background: #fff; border-radius: 16px; box-shadow: 0 2px 16px #0f3d6b20;">
    <h2 style="color:#0f3d6b; text-align:center;">AI Question Generator</h2>
    <form id="genForm">
      <label>Class:</label>
      <input name="class" type="text" required />

      <label>Subject:</label>
      <input name="subject" type="text" required />

      <label>Topic/Chapter:</label>
      <input name="topic" type="text" required />

      <label>Marks per Question:</label>
      <select name="marks" required>
        <option>1</option>
        <option>2</option>
        <option>4</option>
      </select>

      <label>Difficulty:</label>
      <select name="difficulty" required>
        <option>easy</option>
        <option>medium</option>
        <option>hard</option>
      </select>

      <label>No. of Questions:</label>
      <input name="count" type="number" min="1" max="10" value="2" required />

      <label>Instructions/Keywords (optional):</label>
      <textarea name="instructions" rows="2"></textarea>

      <div style="margin-top: 12px; text-align: center;">
        <input type="checkbox" id="questionsOnly" name="questionsOnly" />
        <label for="questionsOnly">Questions Only (hide answers/solutions)</label>
      </div>

      <button type="submit" style="width: 100%; padding: 10px; background: #1762a7; color: white; border: none; border-radius: 8px; font-size: 1.1em; font-weight: bold; margin-top: 12px; cursor: pointer;">
        Generate
      </button>
    </form>

    <div id="output" style="margin-top: 28px;"></div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

  <script>
    if (!firebase.apps.length) {
      const firebaseConfig = {
        apiKey: "AIzaSyAszVhWXUUOYLQ7VimKmPKf1yEu_CI9RCE",
        authDomain: "stpatricks-questionbank.firebaseapp.com",
        projectId: "stpatricks-questionbank",
        storageBucket: "stpatricks-questionbank.appspot.com",
        messagingSenderId: "917615322861",
        appId: "1:917615322861:web:c6c890aa2184dd395b8ee4",
      };
      firebase.initializeApp(firebaseConfig);
    }

    const db = firebase.firestore();
    const auth = firebase.auth();

    document.getElementById("genForm").onsubmit = async function (e) {
      e.preventDefault();

      const form = e.target;
      const data = {
        class: form.class.value,
        subject: form.subject.value,
        topic: form.topic.value,
        marks: form.marks.value,
        difficulty: form.difficulty.value,
        count: form.count.value,
        instructions: form.instructions.value,
        questionsOnly: form.questionsOnly.checked,
      };
      const outputDiv = document.getElementById("output");
      outputDiv.innerHTML = "Generating questions, please wait...";

      try {
        const response = await fetch("https://22f773db-8a2d-4142-9ba1-88c12864daa0-00-1civ713u5lhhg.pike.repl.co/generate", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        });

        const result = await response.json();

        if (result.error) {
          outputDiv.innerHTML = "Error: " + result.error;
          return;
        }

        let outputHTML = "";
        let items = result.result.split(/\n?\d+\.\s/).filter(Boolean);

        if (items.length > 1) {
          outputHTML = items
            .map(
              (q, i) =>
                `<div class="question" style="background:#eaf1fa; border-radius:10px; padding:12px; margin-bottom:10px;"><b>Q${i + 1}.</b> ${q.trim()}</div>`
            )
            .join("");
        } else {
          outputHTML = `<div class="question" style="background:#eaf1fa; border-radius:10px; padding:12px; margin-bottom:10px;">${result.result}</div>`;
        }
        outputDiv.innerHTML = outputHTML;

        if (window.MathJax) window.MathJax.typesetPromise();
      } catch (err) {
        outputDiv.innerHTML = "Request failed. " + err;
      }
    };
  </script>
</body>
</html>
