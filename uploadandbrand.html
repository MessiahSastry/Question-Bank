<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Upload & Brand Question Paper</title>
  <meta name="viewport" content="width=900, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <style>
    body {
      background: #f4f8fc;
      margin: 0;
      padding: 0;
      font-family: 'Times New Roman', Times, serif;
    }
    #page-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0;
      min-height: 100vh;
      padding-bottom: 36px;
    }
    .upload-card {
      background: white;
      border-radius: 13px;
      box-shadow: 0 6px 24px #0f3d6b22;
      margin-top: 40px;
      width: 99vw;
      max-width: 470px;
      padding: 35px 24px 28px 24px;
      display: flex;
      flex-direction: column;
      align-items: stretch;
    }
    .subheading {
      font-size: 1.15em;
      font-weight: 600;
      color: #0f3d6b;
      letter-spacing: 0.04em;
      margin-bottom: 18px;
      text-align: center;
      font-family: inherit;
    }
    .form-group {
      margin-bottom: 18px;
    }
    .form-group label {
      font-weight: 600;
      color: #185496;
      display: block;
      margin-bottom: 7px;
      font-size: 1em;
      font-family: inherit;
    }
    .form-group input[type="text"],
    .form-group input[type="file"] {
      width: 100%;
      padding: 10px 12px;
      border-radius: 7px;
      border: 1.3px solid #bdd7f6;
      font-size: 1em;
      background: #fafdff;
      box-sizing: border-box;
      height: 44px;
      font-family: inherit;
    }
    .form-group input[type="file"] { padding: 7px 4px; height: auto; background: none; }
    .submit-btn {
      background: #1463ad;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      padding: 15px 0;
      margin-top: 7px;
      width: 100%;
      border-radius: 8px;
      border: none;
      font-size: 1.11em;
      box-shadow: 0 2px 10px #0f3d6b0c;
      font-family: inherit;
    }
    .submit-btn:active { transform: scale(0.98);}
    #downloadLink {
      display: none; margin-top:16px; color: #0f3d6b;
      text-decoration: underline; font-weight:bold; text-align: center;
      font-family: inherit;
    }
    @media (max-width: 600px) {
      .upload-card { margin-top: 19px; padding: 12px 3vw 16px 3vw; border-radius: 10px; }
    }
  </style>
</head>
<body>
  <div id="page-container">
    <div class="upload-card">
      <div class="subheading">IIT & NEET FOUNDATION</div>
      <div class="form-group">
        <label>Question Paper PDF (from Examin8):</label>
        <input type="file" id="pdfFile" accept="application/pdf" autocomplete="off">
      </div>
      <div class="form-group">
        <label>School Name:</label>
        <input type="text" id="schoolName" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
      </div>
      <div class="form-group">
        <label>Exam Name:</label>
        <input type="text" id="examName" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
      </div>
      <div class="form-group">
        <label>Class:</label>
        <input type="text" id="className" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
      </div>
      <div class="form-group">
        <label>Subject:</label>
        <input type="text" id="subject" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
      </div>
      <div class="form-group">
        <label>Date (YYYY-MM-DD):</label>
        <input type="text" id="date" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
      </div>
      <div class="form-group">
        <label>Time (minutes):</label>
        <input type="text" id="time" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
      </div>
      <div class="form-group">
        <label>Max Marks:</label>
        <input type="text" id="maxMarks" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
      </div>
      <button class="submit-btn" id="processBtn">Add Header & Download</button>
      <a id="downloadLink">Download Branded PDF</a>
    </div>
  </div>
<script>
function formatDate(dateStr) {
  if (!dateStr) return '';
  // Accepts both "YYYY-MM-DD" and "DD-MM-YYYY" or "DD/MM/YYYY"
  let parts = dateStr.includes('-') ? dateStr.split('-') : dateStr.split('/');
  if (parts.length === 3) {
    if (parts[0].length === 4) {
      // Input is "YYYY-MM-DD" â†’ change to "DD-MM-YYYY"
      return `${parts[2]}-${parts[1]}-${parts[0]}`;
    } else if (parts[2].length === 4) {
      // Already "DD-MM-YYYY" format
      return `${parts[0]}-${parts[1]}-${parts[2]}`;
    }
  }
  return dateStr;
}
document.getElementById('processBtn').onclick = async function () {
  const pdfFile = document.getElementById('pdfFile').files[0];
  const schoolName = document.getElementById('schoolName').value.trim();
  const examName = document.getElementById('examName').value.trim();
  const className = document.getElementById('className').value.trim();
  const subject = document.getElementById('subject').value.trim();
  const date = document.getElementById('date').value.trim();
  const time = document.getElementById('time').value.trim();
  const maxMarks = document.getElementById('maxMarks').value.trim();
  if (!pdfFile) return alert("Please select a PDF to brand!");
  const pdfBytes = await pdfFile.arrayBuffer();
  const pdfDoc = await PDFLib.PDFDocument.load(pdfBytes);

  async function fetchLogo(path) {
    const res = await fetch(path);
    if (!res.ok) throw new Error("Logo file not found: " + path);
    const arr = await res.arrayBuffer();
    return await pdfDoc.embedPng(arr);
  }
  const logo1Img = await fetchLogo('schoollogo1.png');
  const logo2Img = await fetchLogo('schoollogo2.png');
  const logo1Dims = logo1Img.scale(66 / logo1Img.height); // 66px height
  const logo2Dims = logo2Img.scale(66 / logo2Img.height);

  const font = await pdfDoc.embedFont(PDFLib.StandardFonts.TimesBold);
  const fontReg = await pdfDoc.embedFont(PDFLib.StandardFonts.TimesRoman);

  // Edit FIRST PAGE ONLY
  const page = pdfDoc.getPage(0);
  const { width, height } = page.getSize();

  // Header block positions
  const marginL = 45, marginR = 45, headH = 170; // taller to erase Examin8 header fully
  page.drawRectangle({
    x: 0, y: height - headH,
    width: width, height: headH,
    color: PDFLib.rgb(1, 1, 1), opacity: 1
  });

  // Logos
  page.drawImage(logo1Img, {
    x: marginL,
    y: height - headH + 34,
    width: logo1Dims.width,
    height: logo1Dims.height
  });
  page.drawImage(logo2Img, {
    x: width - marginR - logo2Dims.width,
    y: height - headH + 34,
    width: logo2Dims.width,
    height: logo2Dims.height
  });

  // Main headings (center, NO school name)
  page.drawText('IIT & NEET FOUNDATION', {
    x: width / 2 - fontReg.widthOfTextAtSize('IIT & NEET FOUNDATION', 15) / 2,
    y: height - 72,
    size: 15,
    font: fontReg,
    color: PDFLib.rgb(0.08, 0.25, 0.48)
  });
  if (examName)
    page.drawText(examName, {
      x: width / 2 - font.widthOfTextAtSize(examName, 15) / 2,
      y: height - 96,
      size: 15,
      font,
      color: PDFLib.rgb(0.12, 0.12, 0.16)
    });

  // Details rounded box (subject in center, blue border)
  const boxW = width - 100, boxH = 55, boxY = height - headH - 18;
  page.drawRectangle({
    x: 50, y: boxY, width: boxW, height: boxH,
    borderColor: PDFLib.rgb(0.24, 0.60, 0.96),
    color: PDFLib.rgb(0.98, 0.99, 1),
    borderWidth: 2, borderRadius: 15, opacity: 1
  });

  // Top row: Class, Subject (big, bold, center), Date
  const subj = subject.toUpperCase();
  if (className)
    page.drawText("Class: " + className, {
      x: 68,
      y: boxY + boxH - 22,
      size: 12.5,
      font,
      color: PDFLib.rgb(0.11, 0.23, 0.53)
    });
  if (subject)
    page.drawText(subj, {
      x: width / 2 - font.widthOfTextAtSize(subj, 17) / 2,
      y: boxY + boxH - 20,
      size: 17,
      font,
      color: PDFLib.rgb(0.07, 0.18, 0.5)
    });
  if (date)
    page.drawText("Date: " + formatDate(date), {
      x: width - 168,
      y: boxY + boxH - 22,
      size: 12.5,
      font,
      color: PDFLib.rgb(0.11, 0.23, 0.53)
    });

  // Second row: Time, Max Marks
  if (time)
    page.drawText("Time: " + time + " min", {
      x: 68,
      y: boxY + 13,
      size: 12.5,
      font,
      color: PDFLib.rgb(0.15, 0.24, 0.35)
    });
  if (maxMarks)
    page.drawText("Max Marks: " + maxMarks, {
      x: width - 168,
      y: boxY + 13,
      size: 12.5,
      font,
      color: PDFLib.rgb(0.15, 0.24, 0.35)
    });

  // Save & download
  const newPdfBytes = await pdfDoc.save();
  const blob = new Blob([newPdfBytes], { type: 'application/pdf' });
  const url = URL.createObjectURL(blob);
  const link = document.getElementById('downloadLink');
  link.href = url;
  link.download = 'QuestionPaper_Branded.pdf';
  link.style.display = '';
  link.innerText = 'Download Branded PDF';
  link.click();
};
</script>
</body>
</html>
