<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Upload & Brand | St. Patrick's School Header</title>
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <style>
    body { font-family: 'Times New Roman', Times, serif; background: #f4f8fc; }
    .box {
  width: 98vw;
  max-width: 430px;
  margin: 18px auto;
  padding: 18px 6vw 18px 6vw;
  background: #fff;
  border-radius: 20px;
  box-shadow: 0 6px 24px #0f3d6b22;
  box-sizing: border-box;
}

@media (max-width: 600px) {
  .box {
    width: 98vw;
    max-width: 99vw;
    margin: 10px 0 0 0;
    padding: 14px 2vw 18px 2vw;
    border-radius: 15px;
    box-shadow: 0 2px 10px #0f3d6b17;
  }
  input[type="text"], input[type="file"] {
    font-size: 1.11em;
  }
  button {
    width: 100%;
    font-size: 1.12em;
    padding: 13px 0;
  }
}
    .header { font-size: 1.35em; font-weight: bold; color: #0f3d6b; margin-bottom: 20px; }
    label { display: block; margin: 12px 0 6px; }
    input[type="file"], input[type="text"] { margin-bottom: 14px; font-size: 1em; }
    input[type="text"] { width: 98%; padding: 6px; border-radius: 7px; border: 1px solid #aac; }
    button { background: #0f3d6b; color: #fff; padding: 11px 30px; border: none; border-radius: 8px; font-size: 1em; cursor: pointer; margin-top: 12px;}
    #downloadLink { display:none; margin-top:18px; color: #0f3d6b; text-decoration: underline; font-weight:bold; }
  </style>
</head>
<body>
<div class="box">
  <div class="header">Upload & Brand<br>Question Paper</div>
  <label>Question Paper PDF (from Examin8):</label>
  <input type="file" id="pdfFile" accept="application/pdf"><br>
  <label>School Name:</label>
  <input type="text" id="schoolName" value="St. Patrick's School"><br>
  <label>Exam Name:</label>
  <input type="text" id="examName" placeholder="Formative Assessment 1"><br>
  <label>Class:</label>
  <input type="text" id="className" placeholder="10th Class"><br>
  <label>Subject:</label>
  <input type="text" id="subject" placeholder="SCIENCE"><br>
  <label>Date (YYYY-MM-DD):</label>
  <input type="text" id="date" placeholder="2025-06-11"><br>
  <label>Time (minutes):</label>
  <input type="text" id="time" placeholder="90"><br>
  <label>Max Marks:</label>
  <input type="text" id="maxMarks" placeholder="40"><br>
  <button id="processBtn">Add Header & Download</button>
  <a id="downloadLink">Download Branded PDF</a>
</div>

<script>
function formatDate(dateStr) {
  if (!dateStr) return '';
  let [y, m, d] = dateStr.split('-');
  return d && m && y ? `${d}-${m}-${y}` : dateStr;
}
document.getElementById('processBtn').onclick = async function () {
  const pdfFile = document.getElementById('pdfFile').files[0];
  const schoolName = document.getElementById('schoolName').value.trim() || "St. Patrick's School";
  const examName = document.getElementById('examName').value.trim();
  const className = document.getElementById('className').value.trim();
  const subject = document.getElementById('subject').value.trim();
  const date = document.getElementById('date').value.trim();
  const time = document.getElementById('time').value.trim();
  const maxMarks = document.getElementById('maxMarks').value.trim();
  if (!pdfFile) return alert("Please select a PDF to brand!");
  const pdfBytes = await pdfFile.arrayBuffer();
  const pdfDoc = await PDFLib.PDFDocument.load(pdfBytes);

  // Always fetch logos from your assets folder
  async function fetchLogo(path) {
    const res = await fetch(path);
    if (!res.ok) throw new Error("Logo file not found: " + path);
    const arr = await res.arrayBuffer();
    return await pdfDoc.embedPng(arr);
  }
  const logo1Img = await fetchLogo('schoollogo1.png');
  const logo2Img = await fetchLogo('schoollogo2.png');
  const logo1Dims = logo1Img.scale(66 / logo1Img.height); // 66px height
  const logo2Dims = logo2Img.scale(66 / logo2Img.height);

  // Fonts/colors
  const font = await pdfDoc.embedFont(PDFLib.StandardFonts.TimesBold);
  const fontReg = await pdfDoc.embedFont(PDFLib.StandardFonts.TimesRoman);

  // Edit FIRST PAGE ONLY
  const page = pdfDoc.getPage(0);
  const { width, height } = page.getSize();

  // Header block positions
  const marginL = 45, marginR = 45, headH = 170; // taller to erase Examin8 header fully
  // Header white bg (completely opaque and tall)
  page.drawRectangle({
    x: 0, y: height - headH,
    width: width, height: headH,
    color: PDFLib.rgb(1, 1, 1), opacity: 1
  });

  // Logos
  page.drawImage(logo1Img, {
    x: marginL,
    y: height - headH + 34,
    width: logo1Dims.width,
    height: logo1Dims.height
  });
  page.drawImage(logo2Img, {
    x: width - marginR - logo2Dims.width,
    y: height - headH + 34,
    width: logo2Dims.width,
    height: logo2Dims.height
  });

  // Main headings (center)
  page.drawText(schoolName, {
    x: width / 2 - font.widthOfTextAtSize(schoolName, 24) / 2,
    y: height - 60,
    size: 24,
    font,
    color: PDFLib.rgb(0.10, 0.18, 0.5)
  });
  page.drawText('IIT & NEET FOUNDATION', {
    x: width / 2 - fontReg.widthOfTextAtSize('IIT & NEET FOUNDATION', 15) / 2,
    y: height - 87,
    size: 15,
    font: fontReg,
    color: PDFLib.rgb(0.08, 0.25, 0.48)
  });
  page.drawText(examName, {
    x: width / 2 - font.widthOfTextAtSize(examName, 15) / 2,
    y: height - 108,
    size: 15,
    font,
    color: PDFLib.rgb(0.12, 0.12, 0.16)
  });

  // Details rounded box (subject in center, blue border)
  const boxW = width - 100, boxH = 55, boxY = height - headH - 18;
  page.drawRectangle({
    x: 50, y: boxY, width: boxW, height: boxH,
    borderColor: PDFLib.rgb(0.24, 0.60, 0.96),
    color: PDFLib.rgb(0.98, 0.99, 1),
    borderWidth: 2, borderRadius: 15, opacity: 1
  });

  // Top row: Class, Subject (big, bold, center), Date
  const subj = subject.toUpperCase();
  page.drawText("Class: " + className, {
    x: 68,
    y: boxY + boxH - 22,
    size: 12.5,
    font,
    color: PDFLib.rgb(0.11, 0.23, 0.53)
  });
  page.drawText(subj, {
    x: width / 2 - font.widthOfTextAtSize(subj, 17) / 2,
    y: boxY + boxH - 20,
    size: 17,
    font,
    color: PDFLib.rgb(0.07, 0.18, 0.5)
  });
  page.drawText("Date: " + formatDate(date), {
    x: width - 168,
    y: boxY + boxH - 22,
    size: 12.5,
    font,
    color: PDFLib.rgb(0.11, 0.23, 0.53)
  });

  // Second row: Time, Max Marks
  page.drawText("Time: " + time + " min", {
    x: 68,
    y: boxY + 13,
    size: 12.5,
    font,
    color: PDFLib.rgb(0.15, 0.24, 0.35)
  });
  page.drawText("Max Marks: " + maxMarks, {
    x: width - 168,
    y: boxY + 13,
    size: 12.5,
    font,
    color: PDFLib.rgb(0.15, 0.24, 0.35)
  });

  // Save & download
  const newPdfBytes = await pdfDoc.save();
  const blob = new Blob([newPdfBytes], { type: 'application/pdf' });
  const url = URL.createObjectURL(blob);
  const link = document.getElementById('downloadLink');
  link.href = url;
  link.download = 'QuestionPaper_Branded.pdf';
  link.style.display = '';
  link.innerText = 'Download Branded PDF';
  link.click();
};
</script>
</body>
</html>
