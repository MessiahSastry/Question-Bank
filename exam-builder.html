<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
    <meta charset="UTF-8" />
    <title>Exam Builder - Setup | St. Patrick's School</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.2/Sortable.min.js"></script>
    <style>
        :root {
            --primary-blue: #0f3d6b;
            --secondary-blue: #1762a7;
            --light-blue-bg: #f4f8fc;
            --border-color: #bcd6ef;
            --text-dark: #12416c;
            --text-light: #54656f;
        }
        html { height: -webkit-fill-available; }
        body {
            margin: 0; padding: 0; font-family: 'Segoe UI', Arial, sans-serif;
            background-color: #f4f8fc;
            height: 100vh;
            height: -webkit-fill-available;
        }
        body::after {
            content: "St. Patrick's\A IIT & NEET FOUNDATION";
            white-space: pre; position: fixed; top: 50%; left: 50%;
            transform: translate(-50%, -50%); font-size: 5vw; font-weight: bold;
            color: rgba(15, 61, 107, 0.04); z-index: -1; text-align: center;
            pointer-events: none; line-height: 1.2;
        }
        .page-wrapper {
            display: flex; flex-direction: column; height: 100vh;
        }
        #main-header {
            background: linear-gradient(90deg, #1762a7, #0f3d6b);
            color: #fff; border-bottom-left-radius: 28px; border-bottom-right-radius: 28px;
            min-height: var(--header-height); display: flex; flex-direction: column;
            align-items: center; justify-content: center; padding: 15px 10px 18px 10px;
            box-sizing: border-box; flex-shrink: 0;
            position: sticky; top: 0; z-index: 10;
        }
        #main-header .school-title { font-size: 1.8em; font-weight: bold; margin: 0;}
        #main-header .subtitle { font-size: 1.05em; color: #e0eaff; margin-top: 5px; }
        main {
            flex: 1 1 0%;
            min-height: 0;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
            box-sizing: border-box;
        }
        .setup-form-container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto 20px auto;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 4px 18px rgba(0, 27, 68, 0.1);
            padding: 25px 16px;
            flex-shrink: 0;
            overflow-x: hidden;
            box-sizing: border-box;
        }
        .setup-form-container h2 { text-align: center; color: var(--primary-blue); margin-top: 0; margin-bottom: 25px; }
        #exam-setup-form h3 {
            margin-top: 25px; margin-bottom: 15px;
            color: var(--secondary-blue); border-bottom: 2px solid #e0eaff; padding-bottom: 10px;
            font-size: 1.2em; display: flex; align-items: center; gap: 10px;
        }
        #exam-setup-form h3:first-of-type { margin-top: 0; }
        .form-grid-1-col, .form-grid-2-col { display: grid; gap: 15px; }
        .form-grid-1-col { grid-template-columns: 1fr; }
        @media (max-width: 600px) {
            main { padding-top: 20px; }
        }
        .form-group { margin-bottom: 0; }
        .form-group label {
            font-weight: 600; margin-bottom: 5px;
            color: #185496; display: block;
        }
        .form-group input[type="text"], .form-group input[type="number"], .form-group input[type="date"],
        .form-group textarea, .custom-dropdown .selected-option {
            width: 100%; padding: 10px 12px; border-radius: 6px;
            border: 1.3px solid #bcd6ef; font-size: 1em; background: #f7fafd;
            box-sizing: border-box; height: 42px;
        }
        .form-group textarea { height: auto; min-height: 80px; }
        .custom-dropdown { position: relative; }
        .custom-dropdown .selected-option { cursor: pointer; }
        .dropdown-options {
            display: none; position: absolute; top: 100%; left: 0; right: 0;
            background: #fff; border: 1.3px solid #bcd6ef; border-top: none;
            border-radius: 0 0 6px 6px; box-shadow: 0 6px 15px rgba(0, 27, 68, 0.1);
            z-index: 1000; max-height: 200px; overflow-y: auto;
        }
        .custom-dropdown.open .dropdown-options { display: block; }
        .dropdown-options div[data-value] { padding: 10px 15px; cursor: pointer; }
        .dropdown-options div[data-value]:hover { background: #e0eaff; }
        .multi-select-dropdown .dropdown-options div { display: flex; align-items: center; padding: 10px 15px; }
        .multi-select-dropdown .dropdown-options div:hover { background: #e0eaff; }
        .multi-select-dropdown input[type="checkbox"] { margin-right: 10px; }
        .multi-select-dropdown .selected-chapters-display {
            min-height: 42px; height: auto; padding: 10px 12px;
            background: #f7fafd; border-radius: 6px;
            border: 1.3px solid #bcd6ef;
            line-height: 1.5; cursor: pointer;
        }
        .placeholder { font-style: normal; color: #5a7a9b; }

        /* --- NEW Section List logic styles --- */
        #sections-list { display: flex; flex-direction: column; gap: 8px; }
        #sections-list .section-item {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 10px;
            padding: 20px 16px 14px 16px;
            border: 1.3px solid #bcd6ef;
            border-radius: 12px;
            background: #fff;
            margin-bottom: 16px;
            min-height: 42px;
            box-shadow: 0 4px 18px rgba(0, 27, 68, 0.07);
        }
        .section-logic-fields {
            flex: 1 1 260px;
            min-width: 220px;
            margin-top: 6px;
            margin-bottom: 6px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .internal-choice-pairs {
            width: 100%;
            margin-top: 6px;
            margin-bottom: 2px;
        }
        .drag-handle { cursor: grab; color: #5a7a9b; }
        .remove-section-btn { background: none; border: none; color: #c82333; cursor: pointer; font-size: 1.1em; }
        #add-section-btn {
            background: none; border: 1px dashed #1762a7; color: #1762a7;
            padding: 8px 12px; border-radius: 6px; cursor: pointer; font-weight: 600;
        }
        .submit-btn {
            background: linear-gradient(90deg, #1762a7, #0f3d6b);
            color: #fff; font-weight: bold; cursor: pointer; padding: 12px 0;
            margin-top: 25px; width: 100%; border-radius: 8px; border: none; font-size: 1.05em;
        }
        html, body { overflow-x: hidden !important; }
        .section-item select,
            .section-item input[type="number"],
            .section-item input[type="text"] {
                width: auto;
                min-width: 90px;
                padding: 9px 12px;
                border-radius: 6px;
                border: 1.3px solid #bcd6ef;
                font-size: 1em;
                background: #f7fafd;
                color: #12416c;
                outline: none;
                transition: border-color 0.2s;
                margin-bottom: 6px;
            }
            .section-item select:focus,
            .section-item input[type="number"]:focus,
            .section-item input[type="text"]:focus {
                border-color: #1762a7;
            }
            .section-item label {
                font-weight: 600;
                color: #185496;
                font-size: 0.97em;
                margin-bottom: 2px;
            }
            .section-item .remove-section-btn {
                background: #f7dede;
                border: none;
                color: #c82333;
                cursor: pointer;
                font-size: 1.1em;
                border-radius: 50%;
                width: 28px;
                height: 28px;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: background 0.15s;
            }
            .section-item .remove-section-btn:hover {
                background: #fbbcbc;
            }
    </style>
</head>
<body>
    <div class="page-wrapper">
        <header id="main-header">
            <h1 class="school-title">St. Patrick's School</h1>
            <div class="subtitle">IIT & NEET FOUNDATION</div>
        </header>
        <main>
            <div class="setup-form-container">
                <h2>Exam Builder</h2>
                <form id="exam-setup-form">
                    <h3><i class="fas fa-file-alt"></i> Basic Information</h3>
                    <div class="form-grid-2-col">
                        <div class="form-group">
                            <label>Class</label>
                            <div id="class-dropdown" class="custom-dropdown"></div>
                        </div>
                        <div class="form-group">
                            <label>Subject</label>
                            <div id="subject-dropdown" class="custom-dropdown"></div>
                        </div>
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label>Chapters (select one or more)</label>
                            <div id="chapters-multiselect" class="multi-select-dropdown custom-dropdown">
                                <div class="selected-chapters-display placeholder">Select subject to see chapters</div>
                                <div class="dropdown-options"></div>
                            </div>
                        </div>
                    </div>
                    <h3><i class="fas fa-list-ol"></i> Exam Details</h3>
                    <div class="form-group">
                        <label>Exam Name</label>
                        <div id="exam-name-dropdown" class="custom-dropdown"></div>
                    </div>
                    <div class="form-group">
                        <label>Exam Type</label>
                        <div id="exam-type-dropdown" class="custom-dropdown"></div>
                    </div>
                    <div class="form-group">
                        <label>Max Marks</label>
                        <input type="number" id="max-marks-input" placeholder="e.g. 100">
                    </div>
                    <div class="form-group">
                        <label>Time (in minutes)</label>
                        <input type="number" id="time-input" value="90">
                    </div>
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="date-input">
                    </div>
                    <h3><i class="fas fa-sitemap"></i> Paper Structure</h3>
                    <div class="form-grid-1-col">
                        <div class="form-group">
                            <label>Difficulty Level</label>
                            <div id="difficulty-dropdown" class="custom-dropdown"></div>
                        </div>
                    </div>
                    <!-- SECTION LOGIC BLOCK UPDATED -->
                    <div class="form-group" style="margin-top: 20px;">
                        <label>Sections (Add, set type, and drag to reorder)</label>
                        <div id="sections-list"></div>
                        <button type="button" id="add-section-btn" style="margin-top: 10px;">+ Add Section</button>
                    </div>
                    <div class="form-group" style="margin-top: 20px;">
                        <label>Instructions (Optional)</label>
                        <textarea id="instructions-input" placeholder="e.g., All questions are compulsory..."></textarea>
                    </div>
                    <button type="submit" class="submit-btn">Build Exam Draft</button>
                </form>
            </div>
        </main>
    </div>

   <!-- Place this after your form HTML and before </body> -->
<script>
    function extractMCQOptions(q) {
    if (Array.isArray(q.options) && q.options.length === 4) return q.options;
    let stem = q.question || q.text || '';
    let match = stem.match(/^(.*?)(?:A\))\s*([^B]+)B\)\s*([^C]+)C\)\s*([^D]+)D\)\s*([^A]*)(?:Ans:|$)/);
    if (match) {
        return [match[2].trim(), match[3].trim(), match[4].trim(), match[5].trim()];
    }
    return null;
}
    // Shuffle array in-place using Fisher-Yates
function shuffleArray(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
}

// Shuffles MCQ options and remaps answer keys for both Single/Multiple
function shuffleMCQQuestion(questionObj) {
    console.log("Shuffling:", questionObj.options);
    if (!questionObj.options || !questionObj.options.length) return questionObj;

    // Prepare old options and answers
    let { options, answer } = questionObj; // `answer` is like "Ans: A), C)" or "Ans: B)"
    let correctIndices = [];

    // Parse correct options from answer line
    if (typeof answer === 'string') {
        const ansMatches = answer.match(/[A-D]/g);
        if (ansMatches) {
            correctIndices = ansMatches.map(l => "ABCD".indexOf(l));
        }
    } else if (Array.isArray(answer)) {
        correctIndices = answer; // direct indices, rare case
    }

    // Map old options to [option, oldIndex]
    const optPairs = options.map((opt, idx) => ({ opt, idx }));
    shuffleArray(optPairs);

    // New options
    const newOptions = optPairs.map(p => p.opt);

    // New answer indices (A=0, ...)
    const newCorrectIndices = optPairs
        .map((p, newIdx) => (correctIndices.includes(p.idx) ? newIdx : null))
        .filter(x => x !== null);

    // Build new answer line (A), C), ...)
    const ansStr = "Ans: " + newCorrectIndices.map(i => "ABCD"[i] + ")").join(", ");

    // Return new object
    return {
        ...questionObj,
        options: newOptions,
        answer: ansStr
    };
}
document.addEventListener('DOMContentLoaded', () => {
  firebase.auth().onAuthStateChanged(function(user) {
    if (!user) {
      // User not logged in, redirect or show error
      window.location.href = "login.html";
      return;
    }
       const config = {
        classes: ["3rd Class", "4th Class", "5th Class", "6th Class", "7th Class", "8th Class", "9th Class", "10th Class"],
        subjectMappings: {
            "3rd Class": ["Telugu", "Hindi", "English", "Math", "Science", "Social"],
            "4th Class": ["Telugu", "Hindi", "English", "Math", "Science", "Social"],
            "5th Class": ["Telugu", "Hindi", "English", "Math", "Science", "Social"],
            "6th Class": ["Telugu", "Hindi", "English 1", "English 2", "Math 1", "Math 1 IIT", "Math 2", "Math 2 IIT", "Physics", "Physics IIT & NEET", "Chemistry", "Chemistry IIT & NEET", "Biology", "Biology NEET", "Social"],
            "7th Class": ["Telugu", "Hindi", "English 1", "English 2", "Math 1", "Math 1 IIT", "Math 2", "Math 2 IIT", "Physics", "Physics IIT & NEET", "Chemistry", "Chemistry IIT & NEET", "Biology", "Biology NEET", "Social"],
            "8th Class": ["Telugu", "Hindi", "English 1", "English 2", "Math 1", "Math 1 IIT", "Math 2", "Math 2 IIT", "Physics", "Physics IIT & NEET", "Chemistry", "Chemistry IIT & NEET", "Biology", "Biology NEET", "Social"],
            "9th Class": ["Telugu", "Hindi", "English 1", "English 2", "Math 1", "Math 1 IIT", "Math 2", "Math 2 IIT", "Physics", "Physics IIT & NEET", "Chemistry", "Chemistry IIT & NEET", "Biology", "Biology NEET", "Social"],
            "10th Class": ["Telugu", "Hindi", "English 1", "English 2", "Math 1", "Math 1 IIT", "Math 2", "Math 2 IIT", "Physics", "Physics IIT & NEET", "Chemistry", "Chemistry IIT & NEET", "Biology", "Biology NEET", "Social"]
        },
        examNames: ["Slip Test", "Fortnightly Exam", "Formative Assessment", "Summative Assessment"],
        examTypes: ["MCQs", "Descriptive", "Both"],
        difficultyLevels: ["Level 1", "Level 2", "Level 3", "Mixed"],
        sectionLabels: ["Section A", "Section B", "Section C", "Section D", "Section E", "Section F", "Section G"],
        sectionTypes: ["Answer all", "Answer any", "Internal choice"],
        sectionTypeKeys: ["all", "any", "internal"]
    };
function splitCounts(total, percents) {
    let result = percents.map(p => Math.floor(total * p / 100));
    // Distribute any leftover due to rounding
    let sum = result.reduce((a, b) => a + b, 0);
    let diff = total - sum;
    for (let i = 0; diff > 0; i++, diff--) result[i % result.length]++;
    return result;
}
    // --- Fetch chapters for multi-select ---
    const db = {
        getChapters: async (selectedClass, selectedSubject) => {
            try {
                const firestore = firebase.firestore();
                const snapshot = await firestore.collection("questions")
                    .where("class", "==", selectedClass)
                    .where("subject", "==", selectedSubject)
                    .get();
                if (snapshot.empty) return [];
                const chapterSet = new Set();
                snapshot.forEach(doc => {
                    const data = doc.data();
                    if (data.chapter) chapterSet.add(data.chapter);
                });
                return Array.from(chapterSet);
            } catch (error) {
                console.error("Error fetching chapters from Firestore:", error);
                return [];
            }
        }
    };

    // --- Fetch N random questions matching filters from Firestore ---
    async function fetchQuestions({ selectedClass, selectedSubject, chapters, marksPerQuestion, mcqType, count, forceDifficulty }) {
    const firestore = firebase.firestore();
    let query = firestore.collection("questions")
    .where("class", "==", selectedClass)
    .where("subject", "==", selectedSubject);
    if (forceDifficulty) {
        query = query.where("difficulty", "==", forceDifficulty);
    } else if (window.difficultyFilter && window.difficultyFilter !== "Mixed") {
        query = query.where("difficulty", "==", window.difficultyFilter);
    }
        if (chapters && chapters.length) {
        query = query.where("chapter", "in", chapters.slice(0, 10)); // Firestore "in" max 10
    }
    if (marksPerQuestion) {
        query = query.where("marks", "==", parseInt(marksPerQuestion));
    }
    if (mcqType === "Descriptive") {
        // Don't filter by mcqType in Firestore, filter manually after fetching!
        // So, don't add: query = query.where("mcqType", "==", "Descriptive");
    }
    // --- Add MCQ Type filtering here ---
        if (mcqType === "MCQ (Single)") {
        query = query.where("mcqType", "==", "MCQ (Single)");
    } else if (mcqType === "MCQ (Multiple)") {
        query = query.where("mcqType", "==", "MCQ (Multiple)");
    }
    // --- Debug logs ---
    console.log("QUERY FILTERS:", {
        class: selectedClass,
        subject: selectedSubject,
        chapters,
        marksPerQuestion,
        mcqType
    });

    const snapshot = await query.get();
    console.log("RAW FIRESTORE SNAPSHOT SIZE:", snapshot.size);

        snapshot.forEach(doc => {
        console.log("QUESTION DATA:", JSON.stringify(doc.data(), null, 2));
    });

           let allQuestions = [];
        snapshot.forEach(doc => {
            allQuestions.push({ id: doc.id, ...doc.data() });
        });
        
        // Manually filter for Descriptive if needed
        if (mcqType === "Descriptive") {
            allQuestions = allQuestions.filter(q => !q.mcqType || q.mcqType === "Descriptive");
        }

    // Shuffle and pick N random
    for (let i = allQuestions.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [allQuestions[i], allQuestions[j]] = [allQuestions[j], allQuestions[i]];
    }
    return allQuestions.slice(0, count);
}
    // --- Build section instructions ---
    function buildSectionInstructions(sec) {
        if (sec.type === "all") {
            return `Answer all the questions (${sec.numQuestions} x ${sec.marksPerQuestion} = ${sec.numQuestions * sec.marksPerQuestion} Marks)`;
        }
        if (sec.type === "any") {
           return `Answer any ${sec.attemptAny} questions (${sec.attemptAny} x ${sec.marksPerQuestion} = ${sec.attemptAny * sec.marksPerQuestion} Marks)`;
        }
        if (sec.type === "internal") {
            return `Answer any (${sec.numPairs} questions pairs x ${sec.marksPerQuestion} = ${sec.numPairs * sec.marksPerQuestion} Marks)`;
        }
        return "";
    }

    // ---- Custom Dropdown Helper ----
    function createDropdown(containerId, options, placeholder) {
        const container = document.getElementById(containerId);
        if (!container) return;
        const optionsHTML = options.map(opt => `<div data-value="${opt}">${opt}</div>`).join('');
        container.innerHTML = `
            <div class="selected-option">${placeholder}</div>
            <div class="dropdown-options">${optionsHTML}</div>
        `;
        container.dataset.value = '';

        container.addEventListener('click', (e) => {
            e.stopPropagation();
            document.querySelectorAll('.custom-dropdown.open').forEach(d => {
                if (d !== container) d.classList.remove('open');
            });
            container.classList.toggle('open');
            if (e.target.dataset.value) {
                const selectedValue = e.target.dataset.value;
                container.querySelector('.selected-option').textContent = selectedValue;
                container.dataset.value = selectedValue;
                container.classList.remove('open');
                container.dispatchEvent(new Event('change', { bubbles: true }));
            }
        });
    }

    // ---- Section Dropdown Helper (non-native, matches rest) ----
    function createSectionDropdown(options, placeholder, defaultValue, onChange) {
        const dropdown = document.createElement('div');
        dropdown.className = 'custom-dropdown';
        const optionsHTML = options.map(opt => `<div data-value="${opt}">${opt}</div>`).join('');
        dropdown.innerHTML = `
            <div class="selected-option">${defaultValue || placeholder}</div>
            <div class="dropdown-options">${optionsHTML}</div>
        `;
        dropdown.dataset.value = defaultValue || '';
        dropdown.addEventListener('click', (e) => {
            e.stopPropagation();
            document.querySelectorAll('.custom-dropdown.open').forEach(d => {
                if (d !== dropdown) d.classList.remove('open');
            });
            dropdown.classList.toggle('open');
            if (e.target.dataset.value) {
                const val = e.target.dataset.value;
                dropdown.querySelector('.selected-option').textContent = val;
                dropdown.dataset.value = val;
                dropdown.classList.remove('open');
                if (onChange) onChange(val);
            }
        });
        return dropdown;
    }

    function addSection() {
        const list = document.getElementById('sections-list');
        const sectionCount = list.children.length;
        const newItem = document.createElement('div');
        newItem.className = 'section-item';

        // Section Label Dropdown
        const sectionLabelDropdown = createSectionDropdown(
            config.sectionLabels,
            "Select Section",
            config.sectionLabels[sectionCount % config.sectionLabels.length],
            null
        );
        sectionLabelDropdown.classList.add('section-label-dropdown');
        sectionLabelDropdown.style.width = "120px";
        sectionLabelDropdown.style.marginRight = "8px";
        // MCQ Type Dropdown (Single/Multiple, default Single)
           const examType = document.getElementById('exam-type-dropdown').dataset.value;
        let mcqTypeOptions = [];
        if (examType === "MCQs") {
            mcqTypeOptions = ["MCQ (Single)", "MCQ (Multiple)"];
        } else if (examType === "Both") {
            mcqTypeOptions = ["MCQ (Single)", "MCQ (Multiple)", "Descriptive"];
        } else {
            mcqTypeOptions = []; // Hide for Descriptive exam type
        }
        const mcqTypeDropdown = createSectionDropdown(
            mcqTypeOptions,
            "MCQ Type",
            mcqTypeOptions[0] || "",
            null
        );
        mcqTypeDropdown.classList.add('mcq-type-dropdown');
        mcqTypeDropdown.style.width = "150px";
        mcqTypeDropdown.style.marginRight = "10px";
        if (mcqTypeOptions.length === 0) mcqTypeDropdown.style.display = "none";

        // Section Type Dropdown
        const sectionTypeDropdown = createSectionDropdown(
            config.sectionTypes,
            "Select Type",
            config.sectionTypes[0],
            (val) => updateSectionLogicFields(newItem, config.sectionTypeKeys[config.sectionTypes.indexOf(val)])
        );
        sectionTypeDropdown.classList.add('section-type-dropdown');
        sectionTypeDropdown.style.width = "140px";
        sectionTypeDropdown.style.marginRight = "10px";

        // Section Logic fields placeholder
        const logicFields = document.createElement('span');
        logicFields.className = "section-logic-fields";

        // Remove button
        const removeBtn = document.createElement('button');
        removeBtn.type = "button";
        removeBtn.className = "remove-section-btn";
        removeBtn.style.marginLeft = "8px";
        removeBtn.innerHTML = "&times;";
        removeBtn.onclick = () => newItem.remove();

        // Drag handle
        const dragHandle = document.createElement('span');
        dragHandle.className = "drag-handle";
        dragHandle.innerHTML = '<i class="fas fa-grip-vertical"></i>';

        newItem.appendChild(dragHandle);
        newItem.appendChild(sectionLabelDropdown);
        newItem.appendChild(mcqTypeDropdown);
        newItem.appendChild(sectionTypeDropdown);
        newItem.appendChild(logicFields);
        newItem.appendChild(removeBtn);
        // Initial logic fields
        updateSectionLogicFields(newItem, config.sectionTypeKeys[0]);
        updateMCQTypeDropdownVisibility();
        list.appendChild(newItem);
        updateMCQTypeDropdownVisibility();
    }

    function updateSectionLogicFields(sectionItem, typeKey) {
        const logicFields = sectionItem.querySelector('.section-logic-fields');
        logicFields.innerHTML = '';
        if (typeKey === 'all') {
            logicFields.innerHTML = `
                <label style="font-size:0.97em;">
                    Number of questions:
                    <input type="number" class="num-questions-input" min="1" value="1" style="width:50px; margin-left:6px;">
                </label>
                <label style="font-size:0.97em; margin-left:14px;">
                    Marks per question:
                    <input type="number" class="marks-per-question-input" min="1" value="1" style="width:50px; margin-left:6px;">
                </label>
            `;
        } else if (typeKey === 'any') {
            logicFields.innerHTML = `
                <label style="font-size:0.97em;">
                    Total questions:
                    <input type="number" class="num-questions-input" min="1" value="1" style="width:50px; margin:0 6px;">
                </label>
                <label style="font-size:0.97em; margin-left:18px;">
                    Attempt any:
                    <input type="number" class="attempt-any-input" min="1" value="1" style="width:50px; margin-left:6px;">
                </label>
                <label style="font-size:0.97em; margin-left:14px;">
                    Marks per question:
                    <input type="number" class="marks-per-question-input" min="1" value="1" style="width:50px; margin-left:6px;">
                </label>
            `;
        } else if (typeKey === 'internal') {
            logicFields.innerHTML = `
                <label style="font-size:0.97em;">
                    Number of pairs:
                    <input type="number" class="num-pairs-input" min="1" value="1" style="width:50px; margin-left:6px;">
                </label>
                <label style="font-size:0.97em; margin-left:14px;">
                    Marks per pair:
                    <input type="number" class="marks-per-question-input" min="1" value="1" style="width:50px; margin-left:6px;">
                </label>
                <div class="internal-choice-pairs"></div>
            `;
            generateInternalPairs(sectionItem);
            sectionItem.querySelector('.num-pairs-input').addEventListener('input', () => generateInternalPairs(sectionItem));
        }
    }
    function generateInternalPairs(sectionItem) {
        const pairCount = parseInt(sectionItem.querySelector('.num-pairs-input').value) || 1;
        const pairsDiv = sectionItem.querySelector('.internal-choice-pairs');
        // Preserve old selections
        const oldDropdowns = pairsDiv.querySelectorAll('.pair-chapter-dropdown');
        const oldSelections = Array.from(oldDropdowns).map(dd => dd.dataset.value || '');
        
        pairsDiv.innerHTML = ''; // Clear previous pairs
        
        const chapters = Array.from(document.querySelectorAll('#chapters-multiselect input:checked')).map(cb => cb.value);
        
        for (let i = 1; i <= pairCount; i++) {
            const oldA = oldSelections[(i-1)*2] || '';
            const oldB = oldSelections[(i-1)*2+1] || '';
        
            const pairDiv = document.createElement('div');
            pairDiv.style.margin = '6px 0';
            pairDiv.style.display = 'flex';
            pairDiv.style.alignItems = 'center';
        
            const label = document.createElement('label');
            label.style.marginRight = '10px';
            label.textContent = `Pair ${i}:`;
        
            const dropdownA = createSectionDropdown(
                chapters, "Select chapter (a)", chapters.includes(oldA) ? oldA : (chapters[0] || ''), null
            );
            dropdownA.classList.add('pair-chapter-dropdown');
            dropdownA.style.width = "120px";
            dropdownA.style.marginRight = "6px";
        
            const dropdownB = createSectionDropdown(
                chapters, "Select chapter (b)", chapters.includes(oldB) ? oldB : (chapters[0] || ''), null
            );
            dropdownB.classList.add('pair-chapter-dropdown');
            dropdownB.style.width = "120px";
        
            pairDiv.appendChild(label);
            pairDiv.appendChild(dropdownA);
            pairDiv.appendChild(dropdownB);
        
            pairsDiv.appendChild(pairDiv);
        }
        }
    // --- All Other Dropdown Logic (same as before) ---
    createDropdown('class-dropdown', config.classes, 'Select Class');
    createDropdown('subject-dropdown', [], 'Select Class first');
    createDropdown('exam-name-dropdown', config.examNames, 'Select Exam Name');
    createDropdown('exam-type-dropdown', config.examTypes, 'Select Exam Type');
    document.getElementById('exam-type-dropdown').dataset.value = config.examTypes[0]; // <-- add this line right after
    document.getElementById('exam-type-dropdown').addEventListener('change', handleExamTypeChange);
    document.getElementById('exam-type-dropdown').addEventListener('change', updateMCQTypeDropdownVisibility);
    createDropdown('difficulty-dropdown', config.difficultyLevels, 'Select Difficulty');

    document.getElementById('class-dropdown').addEventListener('change', handleClassChange);
    document.getElementById('subject-dropdown').addEventListener('change', handleSubjectChange);
    document.getElementById('exam-setup-form').addEventListener('submit', handleFormSubmit);
    document.getElementById('add-section-btn').addEventListener('click', addSection);
    // --- Automatically manage section(s) based on exam type ---
    function handleExamTypeChange() {
    const examType = document.getElementById('exam-type-dropdown').dataset.value;
    const sectionsList = document.getElementById('sections-list');

    // If MCQs and no sections yet, add Section A
    if (examType === "MCQs" && sectionsList.children.length === 0) {
        addSection();
    }

    // If not MCQs, clear all sections so user can start fresh
    if (examType !== "MCQs") {
        sectionsList.innerHTML = '';
    }

    // For all sections, update the MCQ type dropdown (important for visibility and values)
    document.querySelectorAll('.section-item').forEach(section => {
        const mcqTypeDropdown = section.querySelector('.mcq-type-dropdown');
        if (mcqTypeDropdown) {
            if (examType === "MCQs") {
                // Update options to ["MCQ (Single)", "MCQ (Multiple)"]
                mcqTypeDropdown.innerHTML = `
                  <div class="selected-option">MCQ (Single)</div>
                  <div class="dropdown-options">
                    <div data-value="MCQ (Single)">MCQ (Single)</div>
                    <div data-value="MCQ (Multiple)">MCQ (Multiple)</div>
                  </div>
                `;
                mcqTypeDropdown.style.display = '';
                mcqTypeDropdown.dataset.value = "MCQ (Single)";
            } else if (examType === "Both") {
                mcqTypeDropdown.innerHTML = `
                  <div class="selected-option">MCQ (Single)</div>
                  <div class="dropdown-options">
                    <div data-value="MCQ (Single)">MCQ (Single)</div>
                    <div data-value="MCQ (Multiple)">MCQ (Multiple)</div>
                    <div data-value="Descriptive">Descriptive</div>
                  </div>
                `;
                mcqTypeDropdown.style.display = '';
                mcqTypeDropdown.dataset.value = "MCQ (Single)";
            } else {
                mcqTypeDropdown.style.display = 'none';
                mcqTypeDropdown.dataset.value = "";
            }
        }
    });

    updateMCQTypeDropdownVisibility();
}

    // --- Chapter Multiselect ---
    const chapterContainer = document.getElementById('chapters-multiselect');
    chapterContainer.addEventListener('click', (e) => {
        e.stopPropagation();
        if (e.target.closest('.selected-chapters-display')) {
            if (document.getElementById('subject-dropdown').dataset.value) {
                chapterContainer.classList.toggle('open');
            }
        }
        if (e.target.type === 'checkbox') {
           updateSelectedChaptersDisplay();
        document.querySelectorAll('.section-item').forEach(section => {
            // Only update if this is an "internal" section
            const sectionType = section.querySelector('.section-type-dropdown');
            if (sectionType && sectionType.dataset.value === "Internal choice") {
                generateInternalPairs(section);
            }
        });
        }
    });

    document.addEventListener('click', () => {
        document.querySelectorAll('.custom-dropdown.open').forEach(d => d.classList.remove('open'));
    });

    // --- Helper Functions for Chapters ---
   async function handleClassChange() {
    const selectedClass = document.getElementById('class-dropdown').dataset.value;
    const subjects = config.subjectMappings[selectedClass] || [];
    createDropdown('subject-dropdown', subjects, 'Select Subject');
    // Always reset subject value and text to placeholder
    const subjectDropdown = document.getElementById('subject-dropdown');
    subjectDropdown.dataset.value = '';
    subjectDropdown.querySelector('.selected-option').textContent = 'Select Subject';
    // Fire change event so other dependent fields (like chapters) get cleared
    subjectDropdown.dispatchEvent(new Event('change', { bubbles: true }));
}
    async function handleSubjectChange() {
        const selectedClass = document.getElementById('class-dropdown').dataset.value;
        const selectedSubject = document.getElementById('subject-dropdown').dataset.value;
        const chapterContainer = document.getElementById('chapters-multiselect');
        const optionsContainer = chapterContainer.querySelector('.dropdown-options');
        const display = chapterContainer.querySelector('.selected-chapters-display');
        if (!selectedSubject) {
            optionsContainer.innerHTML = '';
            display.textContent = 'Select subject to see chapters';
            display.classList.add('placeholder');
            updateSelectedChaptersDisplay();
            return;
        }
        optionsContainer.innerHTML = '<div style="padding: 12px; text-align:center;"><i class="fas fa-spinner fa-spin"></i> Loading chapters...</div>';
        display.textContent = 'Loading chapters...';
        display.classList.add('placeholder');
        const prevChecked = chapterContainer.querySelectorAll('input[type="checkbox"]');
        prevChecked.forEach(cb => { cb.checked = false; });
        updateSelectedChaptersDisplay();
        const chapters = await db.getChapters(selectedClass, selectedSubject);
        if (chapters.length > 0) {
            optionsContainer.innerHTML = chapters.map(opt => `<div><label><input type="checkbox" value="${opt}"> ${opt}</label></div>`).join('');
            display.textContent = 'Select one or more chapters';
        } else {
            optionsContainer.innerHTML = '<div style="padding: 10px; font-style: italic;">No chapters found.</div>';
            display.textContent = 'No chapters found';
        }
        display.classList.add('placeholder');
        updateSelectedChaptersDisplay();
    }
    function updateSelectedChaptersDisplay() {
        const chapterContainer = document.getElementById('chapters-multiselect');
        const display = chapterContainer.querySelector('.selected-chapters-display');
        const checkedChapters = Array.from(chapterContainer.querySelectorAll('input:checked')).map(cb => cb.value);
        if (checkedChapters.length === 0) {
            display.textContent = 'Select one or more chapters';
            display.classList.add('placeholder');
        } else {
            display.textContent = checkedChapters.join(', ');
            display.classList.remove('placeholder');
        }
    }

    // --- Form Submit Logic (BUILD PAPER FROM FIRESTORE) ---
    async function handleFormSubmit(event) {
        console.log("FORM SUBMIT HANDLER CALLED");
        event.preventDefault();
        const btn = document.querySelector('.submit-btn');
        btn.disabled = true;
        btn.textContent = "Building Paper...";
        try {
            const sections = [];
            document.querySelectorAll('.section-item').forEach(section => {
                const label = section.querySelector('.section-label-dropdown').dataset.value;
                const typeLabel = section.querySelector('.section-type-dropdown').dataset.value;
                const typeIndex = config.sectionTypes.indexOf(typeLabel);
                const type = config.sectionTypeKeys[typeIndex];
                let sec = { label, type };
                const mcqTypeEl = section.querySelector('.mcq-type-dropdown');
                const mcqType = mcqTypeEl ? mcqTypeEl.dataset.value : "MCQ (Single)";
                sec.mcqType = mcqType;

                if (type === "all") {
                    sec.numQuestions = parseInt(section.querySelector('.num-questions-input').value);
                    sec.marksPerQuestion = parseInt(section.querySelector('.marks-per-question-input').value);
                } else if (type === "any") {
                    sec.numQuestions = parseInt(section.querySelector('.num-questions-input').value);
                    sec.attemptAny = parseInt(section.querySelector('.attempt-any-input').value);
                    sec.marksPerQuestion = parseInt(section.querySelector('.marks-per-question-input').value);
                } else if (type === "internal") {
                    sec.numPairs = parseInt(section.querySelector('.num-pairs-input').value);
                    sec.marksPerQuestion = parseInt(section.querySelector('.marks-per-question-input').value);
                    sec.pairs = [];
                    const pairDivs = section.querySelectorAll('.internal-choice-pairs > div');
                    pairDivs.forEach(div => {
                        // These are custom dropdowns, not <input>, get .dataset.value
                        const [dropdownA, dropdownB] = div.querySelectorAll('.pair-chapter-dropdown');
                        sec.pairs.push({
                            chapterA: dropdownA ? dropdownA.dataset.value : "",
                            chapterB: dropdownB ? dropdownB.dataset.value : ""
                        });
                    });
                }
                sections.push(sec);
            });

            const examConfig = {
                class: document.getElementById('class-dropdown').dataset.value,
                subject: document.getElementById('subject-dropdown').dataset.value,
                chapters: Array.from(document.querySelectorAll('#chapters-multiselect input:checked')).map(cb => cb.value),
                examName: document.getElementById('exam-name-dropdown').dataset.value,
                examType: document.getElementById('exam-type-dropdown').dataset.value,
                maxMarks: document.getElementById('max-marks-input').value,
                time: document.getElementById('time-input').value,
                date: document.getElementById('date-input').value,
                difficulty: document.getElementById('difficulty-dropdown').dataset.value,
                instructions: document.getElementById('instructions-input').value,
                sections
            };

            // --- Validations ---
            if (!examConfig.class || !examConfig.subject || examConfig.chapters.length === 0) {
                showToast("Please select a Class, Subject, and at least one Chapter.", "error");
                btn.disabled = false; btn.textContent = "Build Exam Draft";
                return;
            }
            for (let i = 0; i < sections.length; i++) {
                const sec = sections[i];
                if (!sec.label) {
                    showToast(`Section ${i+1}: Please select section label.`, "error");
                    btn.disabled = false; btn.textContent = "Build Exam Draft";
                    return;
                }
                if (!sec.type) {
                    showToast(`Section ${i+1}: Please select section type.`, "error");
                    btn.disabled = false; btn.textContent = "Build Exam Draft";
                    return;
                }
                if (["all", "any"].includes(sec.type)) {
                    if (!sec.numQuestions || sec.numQuestions < 1) {
                        showToast(`Section ${i+1}: Number of questions must be at least 1.`, "error");
                        btn.disabled = false; btn.textContent = "Build Exam Draft";
                        return;
                    }
                    if (!sec.marksPerQuestion || sec.marksPerQuestion < 1) {
                        showToast(`Section ${i+1}: Marks per question must be at least 1.`, "error");
                        btn.disabled = false; btn.textContent = "Build Exam Draft";
                        return;
                    }
                }
                if (sec.type === "any" && (!sec.attemptAny || sec.attemptAny < 1 || sec.attemptAny > sec.numQuestions)) {
                    showToast(`Section ${i+1}: Attempt any should be between 1 and total questions.`, "error");
                    btn.disabled = false; btn.textContent = "Build Exam Draft";
                    return;
                }
                if (sec.type === "internal") {
                    if (!sec.numPairs || sec.numPairs < 1) {
                        showToast(`Section ${i+1}: Number of pairs must be at least 1.`, "error");
                        btn.disabled = false; btn.textContent = "Build Exam Draft";
                        return;
                    }
                    if (!sec.marksPerQuestion || sec.marksPerQuestion < 1) {
                        showToast(`Section ${i+1}: Marks per pair must be at least 1.`, "error");
                        btn.disabled = false; btn.textContent = "Build Exam Draft";
                        return;
                    }
                    for (let p = 0; p < sec.pairs.length; p++) {
                        if (!sec.pairs[p].chapterA || !sec.pairs[p].chapterB) {
                            showToast(`Section ${i+1} Pair ${p+1}: Both chapters must be entered.`, "error");
                            btn.disabled = false; btn.textContent = "Build Exam Draft";
                            return;
                        }
                    }
                }
            }

            // ---- Build the Exam Paper by fetching questions from Firestore ----
            const finalPaper = {
                class: examConfig.class,
                subject: examConfig.subject,
                date: examConfig.date,
                examName: examConfig.examName,
                instructions: examConfig.instructions,
                time: examConfig.time,        
                maxMarks: examConfig.maxMarks,
                sections: []
            };

          let sectionErrors = [];
          let builtSections = [];
            // Set global difficulty filter for fetchQuestions
            window.difficultyFilter = examConfig.difficulty && examConfig.difficulty !== "Mixed" ? examConfig.difficulty : null;
            for (let i = 0; i < examConfig.sections.length; i++) {
            const sec = examConfig.sections[i];
            let questions = [];
            if (sec.type === "all" || sec.type === "any") {
                const requestedCount = sec.numQuestions;
            if (examConfig.difficulty === "Mixed") {
            // 40% Easy, 30% Medium, 30% Difficult
            let difficultyLevels = ["Level 1", "Level 2", "Level 3"];
            let percentages = [40, 30, 30];
            let counts = splitCounts(requestedCount, percentages);
            for (let d = 0; d < difficultyLevels.length; d++) {
            if (counts[d] > 0) {
                let qs = await fetchQuestions({
                    selectedClass: examConfig.class,
                    selectedSubject: examConfig.subject,
                    chapters: examConfig.chapters,
                    marksPerQuestion: sec.marksPerQuestion,
                    mcqType: sec.mcqType,
                    count: counts[d],
                    forceDifficulty: difficultyLevels[d]
                });
                console.log(`Found ${qs.length} questions for ${difficultyLevels[d]}`);
                questions = questions.concat(qs);
            }
        }
    // Shuffle the combined questions so levels are mixed in order
    for (let i = questions.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [questions[i], questions[j]] = [questions[j], questions[i]];
    }
    questions = questions.slice(0, requestedCount); // In case too many fetched
} else {
    questions = await fetchQuestions({
        selectedClass: examConfig.class,
        selectedSubject: examConfig.subject,
        chapters: examConfig.chapters,
        marksPerQuestion: sec.marksPerQuestion,
        mcqType: sec.mcqType,
        count: requestedCount
    });
}
        if (questions.length < requestedCount) {
            sectionErrors.push(
                `${sec.label} (${sec.mcqType}): Only ${questions.length} of ${requestedCount} questions found.`
            );
            continue; // Skip adding this section
        }
        questions = questions.map((q, idx) => {
            let optionsArr = extractMCQOptions(q);
            let stem = q.question || q.text || '';
            if (
                (sec.mcqType === "MCQ (Single)" || sec.mcqType === "MCQ (Multiple)") &&
                Array.isArray(optionsArr) && optionsArr.length === 4
            ) {
                // Shuffle MCQ options
                const cleanOptionsArr = optionsArr.map(opt => opt.replace(/^[A-D][).]?\s*/, '').trim());
                const shuffled = shuffleMCQQuestion({
                    ...q,
                    options: cleanOptionsArr,
                    question: stem
                });
                return {
                    number: idx + 1,
                    text: shuffled.question || shuffled.text || "",
                    marks: sec.marksPerQuestion,
                    options: shuffled.options || [],
                    answer: shuffled.answer || ""
                };
            } else {
                return {
                    number: idx + 1,
                    text: stem,
                    marks: sec.marksPerQuestion,
                    options: optionsArr || [],
                    answer: q.answer || ""
                };
            }
        });
        } else if (sec.type === "internal") {
        let missingPairs = 0;
        for (let p = 0; p < sec.pairs.length; p++) {
            let qA = await fetchQuestions({
                selectedClass: examConfig.class,
                selectedSubject: examConfig.subject,
                chapters: [sec.pairs[p].chapterA],
                marksPerQuestion: sec.marksPerQuestion,
                count: 1
            });
            let qB = await fetchQuestions({
                selectedClass: examConfig.class,
                selectedSubject: examConfig.subject,
                chapters: [sec.pairs[p].chapterB],
                marksPerQuestion: sec.marksPerQuestion,
                count: 1
            });
            if (qA.length < 1 || qB.length < 1) {
                sectionErrors.push(
                    `${sec.label} (Pair ${p + 1}): Missing question(s) for selected chapters.`
                );
                missingPairs++;
                continue; // Skip this pair
            }
            questions.push({
                number: p + 1,
                text: `a) ${qA[0].question || qA[0].text}<br>b) ${qB[0].question || qB[0].text}`,
                marks: sec.marksPerQuestion,
                image: qA[0].image || qB[0].image || null
            });
        }
        // If even ONE pair is missing, skip the whole section and show error!
        if (missingPairs > 0 || questions.length < sec.numPairs) {
            sectionErrors.push(
                `${sec.label}: Only ${questions.length} of ${sec.numPairs} pairs found.`
            );
            continue;
        }
    }
    builtSections.push({
    name:
      (sec.mcqType === "MCQ (Single)" || sec.mcqType === "MCQ (Multiple)")
        ? `${sec.label} (${sec.mcqType})`
        : sec.label,
    instructions: buildSectionInstructions(sec),
    questions
});
}

// ---- After the for loop ----
if (sectionErrors.length > 0) {
    // If ANY section is missing, show error and STOP (do not build the paper)
    showModalPrompt(
        `<b>Some sections could not be added:</b><br><ul style="text-align:left">${sectionErrors.map(e => `<li>${e}</li>`).join('')}</ul>`
    );
    btn.disabled = false; btn.textContent = "Build Exam Draft";
    return;
}

        // If no errors, build exam with all sections
        if (builtSections.length === 0) {
            showToast("No questions found for this selection. Please check your filters.", "error");
            btn.disabled = false;
            btn.textContent = "Build Exam Draft";
            return;
        }
        finalPaper.sections = builtSections;
        sessionStorage.setItem('examPaper', JSON.stringify(finalPaper));
        window.difficultyFilter = null;
        window.location.href = 'exam-review.html';
        } catch (err) {
        showToast("Error building exam: " + (err.message || err), "error");
        }
        btn.disabled = false;
        btn.textContent = "Build Exam Draft";
    }

    // --- Initial Load ---
    addSection();
    updateMCQTypeDropdownVisibility();
    document.getElementById('date-input').valueAsDate = new Date();
    new Sortable(document.getElementById('sections-list'), { animation: 150, handle: '.drag-handle' });
    });
}); 
// Firebase Config (unchanged)
const firebaseConfig = {
    apiKey: "AIzaSyAszVhWXUUOYLQ7VimKmPKf1yEu_CI9RCE",
    authDomain: "stpatricks-questionbank.firebaseapp.com",
    projectId: "stpatricks-questionbank",
    storageBucket: "stpatricks-questionbank.appspot.com",
    messagingSenderId: "917615322861",
    appId: "1:917615322861:web:c6c890aa2184dd395b8ee4"
};
firebase.initializeApp(firebaseConfig);

function showToast(message, type = 'info') {
    const toast = document.getElementById('toast');
    toast.textContent = message;
    toast.style.background = type === 'error' ? '#c82333' : '#0f3d6b';
    toast.style.display = 'block';
    clearTimeout(window._toastTimeout);
    window._toastTimeout = setTimeout(() => {
        toast.style.display = 'none';
    }, 2300);
}
   function updateMCQTypeDropdownVisibility() {
    const examType = document.getElementById('exam-type-dropdown').dataset.value;
    document.querySelectorAll('.mcq-type-dropdown').forEach(el => {
        el.style.display = (examType === "MCQs" || examType === "Both") ? '' : 'none';
    });
}

    function showModalPrompt(message) {
    const modal = document.getElementById('modal-prompt');
    const msgBox = document.getElementById('modal-prompt-message');
    const okBtn = document.getElementById('modal-prompt-ok');
    msgBox.innerHTML = message; // allows for <br>
    modal.style.display = 'flex';
    okBtn.onclick = () => {
        modal.style.display = 'none';
    };
}
</script>
<div id="toast" style="
        position: fixed;
        bottom: 28px;
        left: 50%;
        transform: translateX(-50%);
        background: #0f3d6b;
        color: #fff;
        padding: 14px 28px;
        border-radius: 8px;
        display: none;
        z-index: 9999;
        font-weight: bold;
        font-size: 1.1em;
        box-shadow: 0 6px 24px rgba(0, 27, 68, 0.18);
    "></div>
    <div id="modal-prompt" style="
    display:none;
    position: fixed;
    top: 0; left: 0; width: 100vw; height: 100vh;
    background: rgba(20,40,80,0.18);
    z-index: 10000;
    align-items: center;
    justify-content: center;">
  <div style="
    background: #fff;
    border-radius: 15px;
    box-shadow: 0 8px 32px #17386855;
    max-width: 340px;
    margin: auto;
    padding: 36px 22px 22px 22px;
    border: 2px solid #c82333;
    display: flex;
    flex-direction: column;
    align-items: center;">
    <div id="modal-prompt-message" style="color: #c82333; font-weight: bold; font-size: 1.13em; text-align: center; margin-bottom: 26px;"></div>
    <button id="modal-prompt-ok" style="
        padding: 8px 26px;
        background: #1762a7;
        color: #fff;
        border-radius: 7px;
        border: none;
        font-weight: 600;
        font-size: 1.06em;
        cursor: pointer;">OK</button>
  </div>
</div>
</body>
</html>
