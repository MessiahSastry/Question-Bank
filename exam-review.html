<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Review Exam Paper | St. Patrick's School</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
    <style>
        body { margin:0; padding:0; font-family:'Segoe UI', Arial, sans-serif; background:#f4f8fc; }
        .page-wrapper { min-height:100vh; }
        #main-header {
            background: linear-gradient(90deg,#1762a7,#0f3d6b);
            color:#fff; border-bottom-left-radius:28px; border-bottom-right-radius:28px;
            padding:24px 10px 18px 10px; display:flex; flex-direction:column; align-items:center;
            position: sticky; top: 0; z-index: 10;
        }
        #main-header .school-title { font-size:2.2em; font-weight:bold; margin:0;}
        #main-header .subtitle { font-size:1.12em; color:#e0eaff; margin-top:4px;}
        main { display:flex; flex-direction:column; align-items:center; padding:18px 8px 40px 8px;}
        .review-container {
            width:100%; max-width:700px; margin:0 auto;
            background:#fff; border-radius:22px; box-shadow:0 4px 16px rgba(0,27,68,0.13);
            padding:32px 20px 34px 20px; margin-top: 30px;
        }
        .section-block { margin-bottom:34px; border:1px solid #bcd6ef2a; border-radius:14px; background: #f8fbfe;}
        .section-header {
            font-size:1.13em; font-weight:700; color:#0f3d6b; background:#eaf4fd; 
            border-bottom:1.3px solid #bcd6ef; padding:14px 14px 12px 14px; 
            border-radius:14px 14px 0 0; cursor:pointer; display: flex; align-items: center;
        }
        .section-header input { 
            font-size:1.13em; font-weight:700; color:#0f3d6b; background:#eaf4fd;
            border:none; outline:none; width:90%; border-radius:6px; padding:5px 8px;
        }
        .question-list { padding: 6px 10px 8px 28px; }
        .question-item {
            display: flex; align-items: flex-start; gap: 10px;
            margin-bottom:18px; background: #f7fafd; border-radius:8px; 
            padding: 12px 10px 12px 10px; box-shadow:0 1px 7px #bcd6ef1a;
            transition: box-shadow 0.15s;
            position: relative;
        }
        .question-item:hover { box-shadow:0 4px 16px #bcd6ef30; }
        .question-meta {
            font-weight:600; color:#1762a7; margin-right:12px; flex-shrink: 0; min-width:90px; cursor:pointer;
        }
        .question-meta input {
            font-weight:600; color:#1762a7; border:none; background:#eaf4fd; 
            border-radius:4px; width:55px; font-size:1em; padding:3px 5px;
        }
        .question-text {
            flex:1; color:#123652; font-size:1.06em; cursor:pointer; word-break:break-word;
        }
        .question-text textarea {
            width:100%; min-height:36px; font-size:1.05em; font-family:'Segoe UI', Arial, sans-serif;
            border: 1.2px solid #bcd6ef; border-radius:5px; resize:vertical; padding:7px 8px; margin:0;
        }
        .delete-btn {
            color:#c82333; background: none; border: none; font-size:1.05em;
            cursor: pointer; opacity: 0; transition: opacity 0.13s; margin-left: 6px;
            position: absolute; right: 10px; top: 10px;
        }
        .question-item:hover .delete-btn { opacity: 1; }
        .add-question-btn {
            background: #eaf4fd; color: #0f3d6b; border: 1px dashed #bcd6ef;
            border-radius: 6px; font-size: 1.02em; font-weight:600; margin-top:10px; cursor:pointer;
            padding: 6px 13px; display:inline-block;
        }
        .footer-actions {
            display:flex; justify-content:center; gap:24px; margin-top:38px;
        }
        .footer-actions button {
            background: linear-gradient(90deg,#1762a7,#0f3d6b); color:#fff; border:none;
            border-radius:12px; font-size:1.15em; font-weight:600; padding:13px 32px;
            box-shadow:0 2px 7px #bcd6ef1a; cursor:pointer; letter-spacing:0.01em; transition:background 0.17s;
        }
        .footer-actions button:hover { background:linear-gradient(90deg,#155ca2,#12416c);}
        @media (max-width:600px){ 
            .review-container{max-width:99vw; padding:12px 5px 14px 5px;}
            .section-header{font-size:1em;}
        }
    </style>
</head>
<body>
<div class="page-wrapper">
    <header id="main-header">
        <div class="school-title">St. Patrick's School</div>
        <div class="subtitle">IIT & NEET FOUNDATION</div>
    </header>
    <main>
        <div class="review-container" id="review-container">
            <h2 style="text-align:center; color:#11385d; margin-bottom: 35px; margin-top: 0;">Review & Edit Question Paper</h2>
            <!-- Sections/questions will be loaded here -->
        </div>
        <div class="footer-actions">
            <button id="save-btn"><i class="fas fa-save"></i> Save Changes</button>
            <button id="export-btn"><i class="fas fa-file-export"></i> Export</button>
        </div>
    </main>
</div>
<script>
function getExamPaper() {
    // Simulated: Use sessionStorage.examPaper, or a sample fallback for demo
    let paper = sessionStorage.getItem('examPaper');
    if (!paper) {
        // DEMO: fallback
        paper = JSON.stringify({
            sections: [
                { title: "Section A: Answer all questions (5x2=10)", questions: [
                    { meta: "Q1 [2 Marks]", text: "What is the capital of India?" },
                    { meta: "Q2 [2 Marks]", text: "Name two rivers in Andhra Pradesh." }
                ]},
                { title: "Section B: Answer any 2 out of 3 (2x5=10)", questions: [
                    { meta: "Q3 [5 Marks]", text: "Explain the process of photosynthesis." },
                    { meta: "Q4 [5 Marks]", text: "Describe the structure of the Indian Parliament." }
                ]}
            ]
        });
    }
    return JSON.parse(paper);
}

let examPaper = getExamPaper();

// Render the question paper for review/editing
function renderPaper() {
    const container = document.getElementById('review-container');
    // Remove old
    container.querySelectorAll('.section-block').forEach(e => e.remove());
    examPaper.sections.forEach((section, secIdx) => {
        const sectionBlock = document.createElement('div');
        sectionBlock.className = 'section-block';

        // --- Section title (inline-edit) ---
        const sectionHeader = document.createElement('div');
        sectionHeader.className = 'section-header';
        sectionHeader.tabIndex = 0;
        sectionHeader.innerText = section.title;

        sectionHeader.onclick = function () {
            if (sectionHeader.querySelector('input')) return;
            const input = document.createElement('input');
            input.value = section.title;
            sectionHeader.innerHTML = '';
            sectionHeader.appendChild(input);
            input.focus();
            input.select();

            input.onblur = function () {
                section.title = input.value.trim() || "Section";
                sectionHeader.innerText = section.title;
            };
            input.onkeydown = function(e) {
                if (e.key === 'Enter') { input.blur(); }
            };
        };

        sectionBlock.appendChild(sectionHeader);

        // --- Questions ---
        const qList = document.createElement('div');
        qList.className = 'question-list';

        section.questions.forEach((question, qIdx) => {
            const qItem = document.createElement('div');
            qItem.className = 'question-item';

            // Inline edit: meta/marks
            const meta = document.createElement('div');
            meta.className = 'question-meta';
            meta.innerText = question.meta;

            meta.onclick = function () {
                if (meta.querySelector('input')) return;
                const input = document.createElement('input');
                input.value = question.meta;
                meta.innerHTML = '';
                meta.appendChild(input);
                input.focus();
                input.select();

                input.onblur = function () {
                    question.meta = input.value.trim() || "";
                    meta.innerText = question.meta;
                };
                input.onkeydown = function(e) {
                    if (e.key === 'Enter') { input.blur(); }
                };
            };

            qItem.appendChild(meta);

            // Inline edit: question text
            const qText = document.createElement('div');
            qText.className = 'question-text';
            qText.innerText = question.text;

            qText.onclick = function () {
                if (qText.querySelector('textarea')) return;
                const textarea = document.createElement('textarea');
                textarea.value = question.text;
                qText.innerHTML = '';
                qText.appendChild(textarea);
                textarea.focus();
                textarea.select();

                textarea.onblur = function () {
                    question.text = textarea.value.trim() || "";
                    qText.innerText = question.text;
                };
                textarea.onkeydown = function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) textarea.blur();
                };
            };

            qItem.appendChild(qText);

            // Delete button
            const delBtn = document.createElement('button');
            delBtn.className = 'delete-btn';
            delBtn.title = 'Delete question';
            delBtn.innerHTML = '<i class="fas fa-trash"></i>';
            delBtn.onclick = function () {
                if (confirm('Delete this question?')) {
                    section.questions.splice(qIdx, 1);
                    renderPaper();
                }
            };
            qItem.appendChild(delBtn);

            qList.appendChild(qItem);
        });

        // Add Question Button
        const addQBtn = document.createElement('button');
        addQBtn.className = 'add-question-btn';
        addQBtn.innerHTML = '<i class="fas fa-plus"></i> Add Question';
        addQBtn.onclick = function () {
            section.questions.push({ meta: `Q${section.questions.length + 1} [2 Marks]`, text: "" });
            renderPaper();
        };

        qList.appendChild(addQBtn);

        sectionBlock.appendChild(qList);
        container.appendChild(sectionBlock);
    });
}

// Save handler (simply updates sessionStorage; real app may POST to backend)
document.getElementById('save-btn').onclick = function() {
    sessionStorage.setItem('examPaper', JSON.stringify(examPaper));
    alert('Changes saved!');
};

// Export handler (placeholder)
document.getElementById('export-btn').onclick = function() {
    alert('Export to PDF/Word coming soon...');
};

renderPaper();

</script>
</body>
</html>
